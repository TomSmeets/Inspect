#!/bin/bash
set -euo pipefail
mkdir -p out


set -x
gcc -c -g -o out/inspect.o embed/inspect.c
gcc -g -o out/test_c embed/test_c.c out/inspect.o
python src/patch.py out/test_c

g++ -g -o out/test_cpp embed/test_cpp.cpp
python src/patch.py out/test_cpp

( cd embed/test_rust; cargo build )
cp embed/test_rust/target/debug/test_rust out
# rustc -o out/test_rust embed/test_rust.rs
python src/patch.py out/test_rust
